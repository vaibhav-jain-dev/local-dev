# Configuration - auto-detects everything from git URLs
# Options per service:
#   enabled: true/false - whether to include in 'make run'
#   always-refresh: true - always pull latest (even without 'refresh' flag)
#   git_repo, git_branch, port, configs - standard settings

services:
  health-api:
    enabled: true
    git_repo: git@github.com:Orange-Health/health-api.git
    git_branch: master
    port: 8000
    # always-refresh: true  # uncomment to always pull latest
    configs:
      - source: configs/health_secrets.py
        dest: app/app/secrets.py
        required: true
      - source: configs/health_creds.json
        dest: serviceAccountKey.json
        required: false
        
  scheduler-api:
    enabled: true
    git_repo: git@github.com:Orange-Health/scheduler-api.git
    git_branch: master
    port: 8010
    configs:
      - source: configs/scheduler_secrets.py
        dest: app/app/secrets.py
        required: true
        
  oms-api:
    enabled: true
    git_repo: git@github.com:Orange-Health/oms.git
    git_branch: main
    port: 8080
    configs:
      - source: configs/oms.yaml
        dest: config/config.yaml
        required: true
      - source: configs/oauth-client.json
        dest: config/oauth-client.json
        required: true

  # Frontend Services
  bifrost:
    enabled: true
    git_repo: git@github.com:Orange-Health/bifrost.git
    git_branch: master
    port: 3000
    type: nextjs
    configs:
      - source: configs/bifrost.env.development
        dest: .env.development
        required: true

  oms-web:
    enabled: true
    git_repo: git@github.com:Orange-Health/oms-web.git
    git_branch: master
    port: 8182
    type: nodejs
    configs:
      - source: configs/oms-web.config.js
        dest: config/config.js
        required: true

  # OMS API with workers - workers share the same repo/branch/clone folder
  # Workers are defined here and get their own Dockerfiles
  # oms-api:
  #   workers:
  #     oms-worker:
  #       dockerfile: oms-worker.dev.Dockerfile
  #       port: 8081
  #     oms-worker-scheduler:
  #       dockerfile: oms-worker-scheduler.dev.Dockerfile
  #       port: 8082
  #     oms-consumer-worker:
  #       dockerfile: oms-consumer-worker.dev.Dockerfile
  #       port: 8083

# Workers - share repo with oms-api but have different Dockerfiles
workers:
  oms-worker:
    parent: oms-api
    port: 8081

  oms-worker-scheduler:
    parent: oms-api
    port: 8082

  oms-consumer-worker:
    parent: oms-api
    port: 8083

# Emulator Apps - run bash scripts instead of Docker containers
# These are only included when --include-app flag is passed
emulators:
  patient-app:
    git_repo: git@github.com:Orange-Health/patient-app.git
    git_branch: copilot/add-dockerized-android-emulator
    script: run-android-emulator.sh

  doctor-app:
    git_repo: git@github.com:Orange-Health/doctor-app.git
    git_branch: copilot/add-dockerized-android-emulator-script
    script: run-android-emulator.sh

redis:
  namespace: s5
  deployment: redis
  port: 6379
